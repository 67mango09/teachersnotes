<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Homework Helper</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:20px; background:#f0f4f8; }
.container { max-width:700px; margin:auto; background:#ffffffcc; padding:20px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
h1 { text-align:center; }
button { padding:10px 20px; border-radius:6px; border:none; background:#007bff; color:white; cursor:pointer; margin:10px 0; }
button:hover { background:#0056b3; }
#extractedText, #answer { margin-top:20px; padding:10px; background:#e8e8e8; border-radius:8px; min-height:40px; white-space: pre-wrap; }
video, canvas { display:block; margin:10px auto; border-radius:8px; max-width:100%; }
</style>
</head>
<body>

<div class="container">
  <h1>Homework Helper</h1>

  <!-- Upload Image -->
  <input type="file" id="questionImage" accept="image/*"><br>
  <button id="solveBtn">Solve Uploaded Homework</button>

  <hr>

  <!-- Webcam Capture -->
  <video id="video" autoplay playsinline width="400" height="300"></video><br>
  <button id="captureBtn">Capture Photo</button>
  <canvas id="canvas" width="400" height="300" style="display:none;"></canvas>
  <button id="solvePhotoBtn">Solve Captured Homework</button>

  <div id="extractedText">Question will appear here...</div>
  <div id="answer">Answer and explanation will appear here...</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@v4.0.2/dist/tesseract.min.js"></script>
<script>
const imageInput = document.getElementById('questionImage');
const solveBtn = document.getElementById('solveBtn');
const extractedTextDiv = document.getElementById('extractedText');
const answerDiv = document.getElementById('answer');

const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const captureBtn = document.getElementById('captureBtn');
const solvePhotoBtn = document.getElementById('solvePhotoBtn');
const ctx = canvas.getContext('2d');

// ------------------- Webcam (Back Camera) -------------------
navigator.mediaDevices.getUserMedia({ video: { facingMode: { exact: "environment" } } })
.catch(() => navigator.mediaDevices.getUserMedia({ video: true }))
.then(stream => { video.srcObject = stream; })
.catch(err => console.error("Camera error:", err));

// ------------------- Capture from Webcam -------------------
captureBtn.addEventListener('click', () => {
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
  alert("Photo captured! Click 'Solve Captured Homework'");
});

// ------------------- OCR + OpenAI -------------------
async function runOCRAndSolve(fileOrCanvas){
  extractedTextDiv.textContent = "Extracting text...";
  answerDiv.textContent = "";
  try{
    const { data: { text } } = await Tesseract.recognize(fileOrCanvas, 'eng', { logger:m=>console.log(m) });
    const questionText = text.trim();
    extractedTextDiv.textContent = "Question:\n" + questionText;

    // OpenAI API Call (frontend, not secure)
    answerDiv.textContent = "Generating answer and explanation...";
    const apiKey = "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"; // Replace with your key
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "Authorization": `Bearer ${apiKey}`
      },
      body: JSON.stringify({
        model:"gpt-4",
        messages:[
          { role:"system", content:"Solve homework questions step by step with explanations." },
          { role:"user", content: questionText }
        ],
        max_tokens:1000
      })
    });
    const data = await response.json();
    const answer = data.choices[0].message.content;
    answerDiv.textContent = answer;
  } catch(err){
    console.error(err);
    extractedTextDiv.textContent = "Error extracting text.";
    answerDiv.textContent = "Unable to generate answer.";
  }
}

// ------------------- Solve Uploaded -------------------
solveBtn.addEventListener('click', () => {
  const file = imageInput.files[0];
  if(!file) return alert("Upload a question image!");
  runOCRAndSolve(file);
});

// ------------------- Solve Captured -------------------
solvePhotoBtn.addEventListener('click', () => {
  runOCRAndSolve(canvas);
});
</script>

</body>
</html>
